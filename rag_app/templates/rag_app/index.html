{% extends "base.html" %}
{% load static %}

{% block title %}Literature Review Generator{% endblock %}

{% block content %}
<div class="container">
  <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
    <a href="{% url 'rag_app:settings' %}" title="Settings" style="text-decoration: none;">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle;"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 8 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 5 15.4a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 8a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 8 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09c0 .66.39 1.26 1 1.51a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 8c.13.21.22.45.22.7s-.09.49-.22.7a1.65 1.65 0 0 0-.33 1.82z"/></svg>
    </a>
  </div>
  <header>
    <h1>RAG Literature Review Generator</h1>
    <p>Select or enter the path to the folder containing your PDF papers.</p>
  </header>

  <form class="upload-form" method="post" action="{% url 'rag_app:generate_review' %}">
    {% csrf_token %}
    <input
      type="text"
      name="folder_path"
      placeholder="e.g. /home/user/papers"
      required
    />
    <button type="submit" class="generate-btn">Generate Review</button>
  </form>

  {% if error %}
    <div class="error">{{ error }}</div>
  {% endif %}

  <h2>Previous Literature Reviews</h2>
  <table class="review-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Created</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for review in reviews %}
      <tr>
        <td data-label="Name">
          <form method="post" action="{% url 'rag_app:rename_review' review.id %}" style="display:inline;">
            {% csrf_token %}
            <input type="text" name="new_name" value="{{ review.display_name }}" style="width: 180px;" />
            <button type="submit">Rename</button>
          </form>
        </td>
        <td data-label="Created">{{ review.started_at|date:"Y-m-d H:i" }}</td>
        <td data-label="Status">{{ review.status }}</td>
        <td data-label="Actions">
          <a href="{% url 'rag_app:review_results' review.id %}">View</a>
          <form method="post" action="{% url 'rag_app:delete_review' review.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" onclick="return confirm('Delete this review?');">Delete</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4">No previous reviews found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
